import{r as s,j as e,B as P,G as h,T as n,c as W,A as C,D as F,d as u}from"./iframe-ByZyHG7Z.js";import{u as N,a as U,g as G,b as V,W as $,C as Y,I as J,d as K,e as z}from"./table-BuDuxKCV.js";import{g as Q}from"./error-eSvF7V3U.js";import{d as X,f as Z,a as ee}from"./format-BWW3-KEh.js";import{S as l}from"./Stack-BYgy4ZNY.js";import{I as te}from"./IconInfoCircle-B0aEKl0P.js";const re=[50,100,200,500],ne={workerId:{fixedWidth:12,priority:0},status:{fixedWidth:6,priority:1},currentRolloutId:{fixedWidth:14,priority:3},currentAttemptId:{fixedWidth:14,priority:3},lastHeartbeatTime:{fixedWidth:10,priority:2},lastBusyTime:{fixedWidth:10,priority:3},lastIdleTime:{fixedWidth:10,priority:3},lastDequeueTime:{fixedWidth:10,priority:1},actions:{fixedWidth:5,priority:0}},m=r=>({absolute:Z(r),relative:X(r)});function ae(r){return{...r,timestamps:{lastHeartbeatTime:m(r.lastHeartbeatTime),lastBusyTime:m(r.lastBusyTime),lastIdleTime:m(r.lastIdleTime),lastDequeueTime:m(r.lastDequeueTime)}}}const se={busy:"orange",idle:"teal",unknown:"gray"};function ie({onShowDetails:r}){return[{accessor:"workerId",title:"Runner ID",sortable:!0,render:({workerId:t})=>e.jsxs(h,{gap:2,wrap:"nowrap",children:[e.jsx(n,{fw:500,size:"sm",children:t}),e.jsx(Y,{value:t,children:({copied:a,copy:i})=>e.jsx(W,{label:a?"Copied":"Copy",withArrow:!0,children:e.jsx(C,{"aria-label":`Copy worker ID ${t}`,variant:"subtle",color:a?"teal":"gray",size:"sm",onClick:o=>{o.stopPropagation(),i()},children:a?e.jsx(J,{size:14}):e.jsx(K,{size:14})})})})]})},{accessor:"status",title:"Status",sortable:!0,render:({status:t})=>{const a=se[t]??"gray";return e.jsx(F,{size:"sm",variant:"light",color:a,radius:"sm",children:ee(t)})}},{accessor:"currentRolloutId",title:"Current Rollout",sortable:!0,render:({currentRolloutId:t})=>e.jsx(n,{size:"sm",children:t??"—"})},{accessor:"currentAttemptId",title:"Current Attempt",sortable:!0,render:({currentAttemptId:t})=>e.jsx(n,{size:"sm",children:t??"—"})},{accessor:"lastHeartbeatTime",title:"Heartbeat",sortable:!0,render:({timestamps:t})=>e.jsxs(l,{gap:0,justify:"center",children:[e.jsx(n,{size:"sm",children:t.lastHeartbeatTime.relative}),t.lastHeartbeatTime.absolute!=="—"&&e.jsx(n,{size:"xs",c:"dimmed",children:t.lastHeartbeatTime.absolute})]})},{accessor:"lastBusyTime",title:"Last Busy",sortable:!0,render:({timestamps:t})=>e.jsxs(l,{gap:0,justify:"center",children:[e.jsx(n,{size:"sm",children:t.lastBusyTime.relative}),t.lastBusyTime.absolute!=="—"&&e.jsx(n,{size:"xs",c:"dimmed",children:t.lastBusyTime.absolute})]})},{accessor:"lastIdleTime",title:"Last Idle",sortable:!0,render:({timestamps:t})=>e.jsxs(l,{gap:0,justify:"center",children:[e.jsx(n,{size:"sm",children:t.lastIdleTime.relative}),t.lastIdleTime.absolute!=="—"&&e.jsx(n,{size:"xs",c:"dimmed",children:t.lastIdleTime.absolute})]})},{accessor:"lastDequeueTime",title:"Last Dequeue",sortable:!0,render:({timestamps:t})=>e.jsxs(l,{gap:0,justify:"center",children:[e.jsx(n,{size:"sm",children:t.lastDequeueTime.relative}),t.lastDequeueTime.absolute!=="—"&&e.jsx(n,{size:"xs",c:"dimmed",children:t.lastDequeueTime.absolute})]})},{accessor:"actions",title:"Actions",textAlign:"left",render:t=>e.jsx(W,{label:"Show runner detail",withArrow:!0,disabled:!r,children:e.jsx(C,{"aria-label":"Show runner detail",variant:"subtle",color:"gray",onClick:a=>{a.stopPropagation(),r(t)},children:e.jsx(te,{size:16})})})}]}function le({workers:r,totalRecords:t,isFetching:a,isError:i,error:o,searchTerm:D,sort:v,page:d,recordsPerPage:c,onSortStatusChange:w,onPageChange:p,onRecordsPerPageChange:B,onResetFilters:k,onRefetch:x,onShowDetails:q,recordsPerPageOptions:A=re}){const{ref:H,width:f}=N(),{width:I}=U(),j=s.useMemo(()=>G(f,I),[f,I]),y=s.useMemo(()=>r?r.map(b=>ae(b)):[],[r]),R=s.useMemo(()=>ie({onShowDetails:q}),[q]),M=s.useMemo(()=>V(R,j,ne),[R,j]),T=s.useMemo(()=>Math.max(1,Math.ceil(Math.max(0,t)/Math.max(1,c))),[c,t]);s.useEffect(()=>{d>T&&p(T)},[p,d,T]);const g=D.trim().length>0,L={columnAccessor:v.column,direction:v.direction},E=s.useCallback(b=>{w(b)},[w]),S=i?Q(o):null,O=i?`Workers are temporarily unavailable${S?` (${S})`:""}.`:"Workers are temporarily unavailable.",_=e.jsx(l,{gap:"sm",align:"center",py:"lg",children:i?e.jsxs(e.Fragment,{children:[e.jsx(n,{fw:600,size:"sm",children:O}),e.jsx(n,{size:"sm",c:"dimmed",ta:"center",children:"Use the retry button to try again, or adjust the search to broaden the results."}),e.jsxs(h,{gap:"xs",children:[e.jsx(u,{size:"xs",variant:"light",color:"gray",leftSection:e.jsx(z,{size:14}),onClick:x,children:"Retry"}),g?e.jsx(u,{size:"xs",variant:"subtle",onClick:k,children:"Clear filters"}):null]})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{fw:600,size:"sm",children:"No workers found"}),e.jsx(n,{size:"sm",c:"dimmed",ta:"center",children:g?"Try adjusting the search to see more results.":"Try refreshing to fetch the latest worker status."}),e.jsxs(h,{gap:"xs",children:[e.jsx(u,{size:"xs",variant:"light",leftSection:e.jsx(z,{size:14}),onClick:x,children:"Refresh"}),g?e.jsx(u,{size:"xs",variant:"subtle",onClick:k,children:"Clear filters"}):null]})]})});return e.jsx(P,{ref:H,children:e.jsx($,{classNames:{root:"workers-table"},withTableBorder:!0,withColumnBorders:!0,highlightOnHover:!0,verticalAlign:"center",minHeight:y.length===0?400:void 0,idAccessor:"workerId",records:y,columns:M,totalRecords:t,recordsPerPage:c,page:d,onPageChange:p,onRecordsPerPageChange:B,recordsPerPageOptions:A,sortStatus:L,onSortStatusChange:E,fetching:a,loaderSize:"sm",emptyState:y.length===0?_:void 0})})}le.__docgenInfo={description:"",methods:[],displayName:"WorkersTable",props:{workers:{required:!0,tsType:{name:"union",raw:"Worker[] | undefined",elements:[{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  workerId: string;
  status: WorkerStatus;
  heartbeatStats: Record<string, any> | null;
  lastHeartbeatTime: Timestamp | null;
  lastDequeueTime: Timestamp | null;
  lastBusyTime: Timestamp | null;
  lastIdleTime: Timestamp | null;
  currentRolloutId: string | null;
  currentAttemptId: string | null;
}`,signature:{properties:[{key:"workerId",value:{name:"string",required:!0}},{key:"status",value:{name:"union",raw:"'idle' | 'busy' | 'unknown'",elements:[{name:"literal",value:"'idle'"},{name:"literal",value:"'busy'"},{name:"literal",value:"'unknown'"}],required:!0}},{key:"heartbeatStats",value:{name:"union",raw:"Record<string, any> | null",elements:[{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},{name:"null"}],required:!0}},{key:"lastHeartbeatTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastDequeueTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastBusyTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastIdleTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"currentRolloutId",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"currentAttemptId",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}}]}}],raw:"Worker[]"},{name:"undefined"}]},description:""},totalRecords:{required:!0,tsType:{name:"number"},description:""},isFetching:{required:!0,tsType:{name:"boolean"},description:""},isError:{required:!0,tsType:{name:"boolean"},description:""},error:{required:!0,tsType:{name:"unknown"},description:""},searchTerm:{required:!0,tsType:{name:"string"},description:""},sort:{required:!0,tsType:{name:"signature",type:"object",raw:"{ column: string; direction: 'asc' | 'desc' }",signature:{properties:[{key:"column",value:{name:"string",required:!0}},{key:"direction",value:{name:"union",raw:"'asc' | 'desc'",elements:[{name:"literal",value:"'asc'"},{name:"literal",value:"'desc'"}],required:!0}}]}},description:""},page:{required:!0,tsType:{name:"number"},description:""},recordsPerPage:{required:!0,tsType:{name:"number"},description:""},onSortStatusChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(status: DataTableSortStatus<WorkersTableRecord>) => void",signature:{arguments:[{type:{name:"DataTableSortStatus",elements:[{name:"intersection",raw:`Worker & {
  timestamps: Record<
    'lastHeartbeatTime' | 'lastBusyTime' | 'lastIdleTime' | 'lastDequeueTime',
    { absolute: string; relative: string }
  >;
}`,elements:[{name:"signature",type:"object",raw:`{
  workerId: string;
  status: WorkerStatus;
  heartbeatStats: Record<string, any> | null;
  lastHeartbeatTime: Timestamp | null;
  lastDequeueTime: Timestamp | null;
  lastBusyTime: Timestamp | null;
  lastIdleTime: Timestamp | null;
  currentRolloutId: string | null;
  currentAttemptId: string | null;
}`,signature:{properties:[{key:"workerId",value:{name:"string",required:!0}},{key:"status",value:{name:"union",raw:"'idle' | 'busy' | 'unknown'",elements:[{name:"literal",value:"'idle'"},{name:"literal",value:"'busy'"},{name:"literal",value:"'unknown'"}],required:!0}},{key:"heartbeatStats",value:{name:"union",raw:"Record<string, any> | null",elements:[{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},{name:"null"}],required:!0}},{key:"lastHeartbeatTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastDequeueTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastBusyTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastIdleTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"currentRolloutId",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"currentAttemptId",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}}]}},{name:"signature",type:"object",raw:`{
  timestamps: Record<
    'lastHeartbeatTime' | 'lastBusyTime' | 'lastIdleTime' | 'lastDequeueTime',
    { absolute: string; relative: string }
  >;
}`,signature:{properties:[{key:"timestamps",value:{name:"Record",elements:[{name:"union",raw:"'lastHeartbeatTime' | 'lastBusyTime' | 'lastIdleTime' | 'lastDequeueTime'",elements:[{name:"literal",value:"'lastHeartbeatTime'"},{name:"literal",value:"'lastBusyTime'"},{name:"literal",value:"'lastIdleTime'"},{name:"literal",value:"'lastDequeueTime'"}]},{name:"signature",type:"object",raw:"{ absolute: string; relative: string }",signature:{properties:[{key:"absolute",value:{name:"string",required:!0}},{key:"relative",value:{name:"string",required:!0}}]}}],raw:`Record<
  'lastHeartbeatTime' | 'lastBusyTime' | 'lastIdleTime' | 'lastDequeueTime',
  { absolute: string; relative: string }
>`,required:!0}}]}}]}],raw:"DataTableSortStatus<WorkersTableRecord>"},name:"status"}],return:{name:"void"}}},description:""},onPageChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(page: number) => void",signature:{arguments:[{type:{name:"number"},name:"page"}],return:{name:"void"}}},description:""},onRecordsPerPageChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: number) => void",signature:{arguments:[{type:{name:"number"},name:"value"}],return:{name:"void"}}},description:""},onResetFilters:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onRefetch:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onShowDetails:{required:!0,tsType:{name:"signature",type:"function",raw:"(worker: Worker) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  workerId: string;
  status: WorkerStatus;
  heartbeatStats: Record<string, any> | null;
  lastHeartbeatTime: Timestamp | null;
  lastDequeueTime: Timestamp | null;
  lastBusyTime: Timestamp | null;
  lastIdleTime: Timestamp | null;
  currentRolloutId: string | null;
  currentAttemptId: string | null;
}`,signature:{properties:[{key:"workerId",value:{name:"string",required:!0}},{key:"status",value:{name:"union",raw:"'idle' | 'busy' | 'unknown'",elements:[{name:"literal",value:"'idle'"},{name:"literal",value:"'busy'"},{name:"literal",value:"'unknown'"}],required:!0}},{key:"heartbeatStats",value:{name:"union",raw:"Record<string, any> | null",elements:[{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>"},{name:"null"}],required:!0}},{key:"lastHeartbeatTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastDequeueTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastBusyTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"lastIdleTime",value:{name:"union",raw:"Timestamp | null",elements:[{name:"number"},{name:"null"}],required:!0}},{key:"currentRolloutId",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"currentAttemptId",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}}]}},name:"worker"}],return:{name:"void"}}},description:""},recordsPerPageOptions:{required:!1,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"",defaultValue:{value:"[50, 100, 200, 500]",computed:!1}}}};export{le as W};
